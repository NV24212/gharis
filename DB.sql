-- SQL Migration for Ghars Project on Supabase
--
-- Instructions:
-- 1. Go to your Supabase project's "SQL Editor".
-- 2. Click on "New query".j
-- 3. Copy and paste the entire content of this file into the editor.
-- 4. Click "Run" to execute the script and create your database tables.
-- 5. After running this, go to "Storage" and create a new public bucket named `videos` for the weekly video uploads.

-- It's highly recommended to enable Row Level Security (RLS) on your tabless
-- and define policies for secure data access, especially for student data.
-- For simplicity, this script does not include RLS policies, but you should
-- add them based on your application's access patterns.

-- Table for Admin Users
-- This table stores the passwords for admin access.
-- In a real-world scenario, you would store a securely hashed password.
-- For this project, as requested, it stores the plain password for a simple check.
CREATE TABLE admins (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    password TEXT NOT NULL UNIQUE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Table for Students
-- Stores student information, including their unique password for login.
CREATE TABLE students (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    password TEXT NOT NULL UNIQUE,
    name TEXT NOT NULL,
    class TEXT,
    points INT DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Table for Weeks
-- Holds the content for each week.
CREATE TABLE weeks (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    title TEXT NOT NULL,
    video_url TEXT, -- This will store the public URL of the video from Supabase Storage
    is_locked BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Table for Content Cards
-- These are the descriptive cards associated with each week.
CREATE TABLE content_cards (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    week_id BIGINT NOT NULL REFERENCES weeks(id) ON DELETE CASCADE,
    title TEXT NOT NULL,
    description TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Initial Data (Optional)
-- You can add an initial admin password here to get started.
-- Replace 'your_secret_admin_password' with the actual password you want to use.
INSERT INTO admins (password) VALUES ('Xnaf*123');
